name: despliegue
on:
  push: 
    branches: 
      - 'main'
  pull_request: 
    branches: 
      - 'main'

jobs: 
  print-on-screen: 
    runs-on: ubuntu-latest
    steps: 
      - run: echo "Primer acciÃ³n ðŸš€"
      - run: echo "Ahora sigue bajar el repo ðŸ”¥"
      - uses: actions/checkout@v3
      - run: echo "Ahora sigue validar los archivos descargados de Github âœ…"
      - run: ls -al 
      - run: echo "Ahora a instalar Node.js versiÃ³n 14 ðŸ”¥"
      - uses: actions/setup-node@v3
        with:
            node-version: '14'
      - run: echo "Ahora sigue validar la instalaciÃ³n 14 âœ…"
      - run: node -v 
      - run: npm -v 
      - run: echo "Por Ãºltimo vamos a ejecutar los tests ðŸ§ª"
      - run: npm run test
      
      - name: Connect via SSH ðŸ”Œ
        uses: appleboy/ssh-action@v0.1.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSHKEY }}
          passphrase: ${{ secrets.PASSPHRASE }}
          password: ${{ secrets.PASSWORD }}
          scripts: |
            # Imprime en pantalla algo 
            echo "Esto corre en el droplet"
            # Vamos a irnos a la carpeta
            cd app/nodejs-postgres-with-docker/
            # Hacer git pull 
            git pull
            # Reload de PM2
            echo "Reload PM2 ðŸš€"
            sudo pm2 reload all

      - run: echo "Success âœ…"
            

